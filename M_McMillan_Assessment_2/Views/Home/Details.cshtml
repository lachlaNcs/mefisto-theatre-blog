@model M_McMillan_Assessment_2.Models.Post
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Details";
}

<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this comment?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-button" data-bs-dismiss="modal">Close</button>
                <a href="#" id="deleteCommentLink" class="btn btn-outline-danger">Delete</a>
            </div>
        </div>
    </div>
</div>


<h2>@Html.DisplayFor(model => model.Title)</h2>
<hr />
<div>
    <div class="row">
        <h5>
            Posted by: @Html.DisplayFor(model => model.Employee.FirstName) @Html.DisplayFor(model => model.Employee.LastName)
        </h5>
        <span style="float: right;">Date Posted: @Html.DisplayFor(model => model.DatePosted)</span>
        @if (Model.DateEdited != null)
        {
            <br />
            <span style="float: right;">Date Edited: @Html.DisplayFor(model => model.DatePosted)</span>

        }
    </div>

    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Category.CategoryName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Category.CategoryName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Description)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Description)
        </dd>

    </dl>
    <br />
    <hr />
    @if (Model.Comments != null && Model.Comments.Any())
    {
        <h3>Comments:</h3>
        <div class="d-inline-block">
            @foreach (var comment in Model.Comments)
            {
                <div class="comment-block">
                    <h6 class="d-inline">@comment.User.UserName:</h6>
                    <p class="d-inline">@comment.Content</p>

                    @if (@comment.UserId == User.Identity.GetUserId() || (User.IsInRole("Admin")) || (User.IsInRole("Moderator")))
                    {
                        <div class="mt-3">
                            <button class="btn btn-sm btn-outline-secondary delete-comment" data-comment-id="@comment.CommentId" data-toggle="modal">Delete</button>
                            @Html.ActionLink("Edit", "EditComment", "Member", new { id = comment.CommentId, postId = Model.PostId }, htmlAttributes: new { @class = "btn btn-sm btn-outline-secondary" })
                        </div>
                    }
                    <hr />
                </div>
            }
        </div>
    }

    else
    {
        <template>
            No comments on this post.
        </template>
    }

</div>
<p>
    @if (!Request.IsAuthenticated)
    {
        @Html.ActionLink("Log in to Comment", "Login", "Account", routeValues: null, htmlAttributes: new { id = "loginLink", @class = "btn btn-outline-secondary " })
    }
    @if (Request.IsAuthenticated)
    {
        if (User.IsInRole("Admin") || (User.IsInRole("Moderator")) || (User.IsInRole("Staff")))
        {
            @Html.ActionLink("Edit Post", "Edit", "Staff", new { id = Model.PostId }, htmlAttributes: new { @class = "btn btn-outline-secondary" })
        }

        if (User.IsInRole("Member") || (User.IsInRole("Admin") || (User.IsInRole("Moderator") || (User.IsInRole("Staff")))))
        {
            @Html.ActionLink("Comment", "Comment", "Member", new { id = Model.PostId }, htmlAttributes: new { @class = "btn btn-outline-secondary ms-3 me-3" })
        }

        if (User.IsInRole("Suspended"))
        {
        <p class="text-danger">You are not allowed to make comments</p>
    }
}
    @Html.ActionLink("Back to Blogs", "GetBlogs", null, htmlAttributes: new { @class = "btn btn-outline-secondary" })
    </p>

    <script>
        $(document).ready(function () {
        $('.delete-comment').on('click', function () {
            var commentId = $(this).data('comment-id');
            $('#deleteCommentLink').attr('href', '@Url.Action("DeleteComment", "Member")/' + commentId);
            $('#deleteConfirmationModal').modal('show');
        });
    });
    </script>

